name: "Github Actions Controller"
description: "Pull & Update specific workflows into a repository"

inputs:
  pull_testing_workflows:
    description: "Workflows for running testing of your code"
    default: "false"
  pull_linting_workflows:
    description: "Workflows for linting your code"
    default: "false"
  pull_build_workflows:
    description: "Workflows for building your code"
    default: "false"
  pull_deployment_workflows:
    description: "Workflows for deploying your code"
    default: "false"
  base_branch:
    description: "Base branch to create PR against"
    default: "main"
  templates_repo:
    description: "Repository containing workflow templates"
    default: "BenFielder/github-actions-controller"

runs:
  using: "composite"
  steps:

    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up Git
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
      shell: bash

    - name: Generate GitHub App Token
      id: generate_token
      uses: actions/create-github-app-token@v2.0.2
      with:
          app_id: ${{ secrets.APP_ID }}
          private_key: ${{ secrets.APP_PRIVATE_KEY }}

    - name: Run controller logic
      run: |
        bash "${{ github.action_path }}/src/scripts/pull_workflows.sh" \
          "${{ inputs.pull_testing_workflows }}" \
          "${{ inputs.pull_linting_workflows }}" \
          "${{ inputs.pull_build_workflows }}" \
          "${{ inputs.pull_deployment_workflows }}" \
          "${{ inputs.base_branch }}" \
          "${{ inputs.templates_repo }}"
      env:
          GITHUB_TOKEN: ${{ steps.generate_token.outputs.token }}
      shell: bash